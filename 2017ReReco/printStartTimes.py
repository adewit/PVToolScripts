import os
import sys
import calendar
import optparse
import importlib
import sqlalchemy
import subprocess
import CondCore.Utilities.conddblib as conddb

##############################################
def execme(command, dryrun=False):
##############################################
    '''Wrapper for executing commands.
    '''
    if dryrun:
        print command
    else:
        print " * Executing: %s ..." % (command)
        os.system(command)
        print " * Executed!"

##############################################
def print_times(inputRun):
##############################################
    con = conddb.connect(url = conddb.make_url())
    session = con.session()
    RunInfo = session.get_dbtype(conddb.RunInfo)
    
    bestRun = session.query(RunInfo.run_number,RunInfo.start_time, RunInfo.end_time).filter(RunInfo.run_number == inputRun).first()
    if bestRun is None:
        raise Exception("Run %s can't be matched with an existing run in the database." %options.runNumber)
    
    start= bestRun[1]
    stop = bestRun[2]
    
    bestRunStartTime = calendar.timegm( bestRun[1].utctimetuple() ) << 32
    bestRunStopTime  = calendar.timegm( bestRun[2].utctimetuple() ) << 32
    
    return (start,stop)
    #print "run start time:",start,"(",bestRunStartTime,")"
    #print "run stop time: ",stop,"(",bestRunStopTime,")"


##############################################
def main():
##############################################
    
    listOfRuns = [297047,297048,297049,297050,297056,297057,297099,297100,297101,297113,297114,297168,297169,297170,297171,297175,297176,297177,297178,297179,297180,297181,297211,297215,297218,297219,297224,297225,297227,297281,297282,297283,297284,297285,297286,297287,297288,297289,297290,297291,297292,297293,297296,297308,297359,297411,297424,297425,297426,297429,297430,297431,297432,297433,297434,297435,297467,297468,297469,297474,297483,297484,297485,297486,297487,297488,297494,297495,297496,297497,297498,297499,297501,297502,297503,297504,297505,297557,297558,297562,297563,297598,297599,297603,297604,297605,297606,297620,297656,297657,297658,297659,297660,297661,297662,297663,297664,297665,297666,297670,297671,297672,297673,297674,297675,297678,297722,297723,298653,298678,298996,298997,298998,299000,299042,299061,299062,299064,299065,299067,299096,299149,299178,299180,299183,299184,299185,299996,300018,300027,300043,300079,300087,300088,300105,300106,300107,300117,300122,300123,300124,300155,300156,300157,300226,300233,300234,300235,300236,300237,300238,300239,300240,300280,300281,300282,300283,300284,300364,300365,300366,300367,300368,300369,300370,300371,300372,300373,300374,300375,300389,300390,300391,300392,300393,300394,300395,300396,300397,300398,300399,300400,300401,300459,300461,300462,300463,300464,300466,300467,300497,300498,300499,300500,300514,300515,300516,300517,300538,300539,300545,300548,300551,300552,300558,300560,300574,300575,300576,300631,300632,300633,300635,300636,300673,300674,300675,300676,300742,300777,300780,300785,300806,300811,300812,300816,300817,301046,301086,301141,301142,301161,301165,301179,301180,301183,301281,301283,301298,301323,301330,301359,301383,301384,301391,301392,301393,301394,301395,301396,301397,301398,301399,301417,301447,301448,301449,301450,301461,301472,301473,301474,301475,301476,301480,301519,301524,301525,301528,301529,301530,301531,301532,301567,301627,301664,301665,301694,301912,301913,301914,301941,301959,301960,302131,302159,302163,302165,302166,302225,302228,302229,302239,302240,302262,302263,302277,302279,302280,302322,302328,302337,302342,302343,302344,302349,302350,302388,302392,302393,302448,302472,302473,302474,302475,302476,302479,302484,302485,302486,302487,302488,302489,302490,302491,302492,302493,302494,302509,302513,302522,302523,302525,302526,302548,302550,302551,302553,302554,302555,302563,302564,302565,302566,302567,302569,302570,302571,302572,302573,302596,302597,302634,302635,302646,302651,302654,302660,302661,302663,303818,303819,303824,303825,303832,303838,303885,303948,303989,303998,303999,304000,304062,304119,304120,304125,304144,304158,304169,304170,304196,304197,304198,304199,304200,304204,304209,304291,304292,304333,304354,304366,304446,304447,304448,304449,304451,304452,304505,304506,304507,304508,304562,304616,304625,304626,304654,304655,304661,304662,304663,304671,304672,304737,304738,304739,304740,304776,304777,304778,304797,305040,305043,305044,305045,305046,305059,305062,305063,305064,305081,305112,305113,305114,305178,305179,305180,305181,305182,305183,305184,305185,305186,305188,305202,305204,305207,305208,305234,305236,305237,305247,305248,305249,305250,305252,305282,305310,305311,305312,305313,305314,305336,305338,305341,305349,305350,305351,305358,305364,305365,305366,305376,305377,305405,305406,305440,305441,305516,305517,305518,305586,305588,305589,305590,305636,305766,305809,305814,305821,305832,305840,305841,305842,305862,305898,305902,305967,306029,306030,306036,306037,306038,306041,306042,306048,306049,306051,306091,306092,306093,306095,306121,306122,306125,306126,306134,306135,306137,306138,306139,306153,306154,306155,306169,306170,306171,306416,306417,306418,306419,306420,306422,306423,306425,306432,306454,306455,306456,306457,306458,306459,306460,306546,306548,306549,306550,306553,306563,306572,306580,306584,306595,306598,306604,306629,306630,306631,306636,306645,306646,306647,306651,306652,306653,306654,306656,306657]

    for run in listOfRuns:
        print run,print_times(run)[0]

if __name__ == "__main__":        
    main()




